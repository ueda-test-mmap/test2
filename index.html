<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Polygon Studio</title>
    <style>
        :root {
            --bg-color: #0b1020;
            --canvas-bg: #0b1020;
            --panel-bg: rgba(18, 22, 38, 0.98);
            --accent-color: #ff66cc;
            --text-color: #e0e0e0;
            --input-bg: #1a1f2e;
            --border-color: rgba(255, 255, 255, 0.12);
        }

        body {
            margin: 0; font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        header {
            padding: 0.6rem 1.2rem; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border-color);
        }

        .main-layout { display: flex; flex: 1; overflow: hidden; }

        /* モバイル対応設定 */
        @media (max-width: 850px) {
            .main-layout { flex-direction: column; overflow-y: auto; }
            .sidebar { width: 100% !important; border-left: none !important; padding: 20px !important; box-sizing: border-box; }
            .preview-area { min-height: 270px; flex: none; padding: 20px; }
            textarea { width: calc(100% - 10px); box-sizing: border-box; padding-right:0; height: 13px; }
        }

        /* キャンバス視覚化 */
        .preview-area {
            flex: 1; display: flex; justify-content: center; align-items: center;
            background: #05070a; position: relative; padding: 40px;
        }

        .canvas-container {
            width: 100%; max-width: 500px; aspect-ratio: 1/1;
            background: var(--canvas-bg); border: 2px solid #334155;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative;
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 10% 10%;
            transition: background-color 0.4s ease;
        }

        svg { width: 100%; height: 100%; overflow: visible; }
        
        .shape-polygon { cursor: move; transition: filter 0.2s; stroke: rgba(255,255,255,0.1); stroke-width: 0.2; }
        .handle { stroke: #fff; stroke-width: 1.5; cursor: grab; transition: r 0.1s; }
        .handle:hover { r: 5; }

        /* サイドバー */
        .sidebar {
            width: 420px; background: var(--panel-bg); padding: 20px;
            border-left: 1px solid var(--border-color); overflow-y: auto;
            display: flex; flex-direction: column; gap: 15px;
        }

        .shape-selector { display: flex; gap: 8px; margin-bottom: 5px; }
        .shape-tab {
            flex: 1; padding: 12px 5px; border-radius: 8px; border: 1px solid var(--border-color);
            background: rgba(255,255,255,0.03); color: #888; cursor: pointer; text-align: center; font-size: 0.7rem;
            transition: 0.2s;
        }
        .shape-tab.active { color: #fff; background: rgba(255,255,255,0.08); border-bottom: 3px solid var(--accent-color); }

        .control-block {
            background: rgba(255,255,255,0.02); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color);
        }

        h3 { font-size: 0.75rem; text-transform: uppercase; margin: 0 0 12px 0; color: var(--accent-color); opacity: 0.9; }

        /* モダンなスイッチ */
        .switch-row { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 5px 0; }
        .switch {
            position: relative; width: 44px; height: 22px;
            background: #334155; border-radius: 20px; transition: 0.3s;
        }
        .switch::after {
            content: ''; position: absolute; width: 18px; height: 18px;
            background: white; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s;
        }
        input:checked + .switch { background: var(--accent-color); }
        input:checked + .switch::after { left: 24px; }
        input[type="checkbox"] { display: none; }

        .input-row { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
        input[type="text"], input[type="range"] {
            flex: 1; background: var(--input-bg); border: 1px solid #334155;
            color: #fff; padding: 10px; border-radius: 6px; font-size: 0.85rem;
        }

        input[type="color"] {
            -webkit-appearance: none; width: 44px; height: 44px; border: none; border-radius: 6px; cursor: pointer; background: none;
        }

        button {
            background: #334155; color: #fff; border: none; padding: 10px 15px;
            border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600;
        }
        button:hover { background: #475569; }

        textarea {
            width: 100%; height: 80px; background: #000; color: #00ffaa;
            border: 1px solid #334155; padding: 10px; border-radius: 6px;
            font-family: monospace; font-size: 0.75rem; resize: none; margin-top: 5px;
        }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 800; letter-spacing: 1px;">POLY STUDIO <span style="color:var(--accent-color)">PRO</span></div>
    <button id="langToggle" style="background:none; border:1px solid #334155; padding:4px 10px; color:#fff; cursor:pointer;">JP / EN</button>
</header>

<div class="main-layout">
    <div class="preview-area">
        <div class="canvas-container" id="canvasBox">
            <svg id="canvas" viewBox="0 0 100 100">
                <polygon id="poly0" class="shape-polygon"></polygon>
                <polygon id="poly1" class="shape-polygon"></polygon>
                <polygon id="poly2" class="shape-polygon"></polygon>
                <g id="handleGroup"></g>
            </svg>
        </div>
    </div>

    <div class="sidebar">
        <div class="shape-selector">
            <div class="shape-tab active" onclick="selectShape(0)" id="tab0">図形 1</div>
            <div class="shape-tab" onclick="selectShape(1)" id="tab1">図形 2</div>
            <div class="shape-tab" onclick="selectShape(2)" id="tab2">図形 3</div>
        </div>

        <div class="control-block">
            <h3 id="ui-h-base">基本設定</h3>
            <label class="switch-row">
                <span id="ui-label-vis">図形を表示する</span>
                <input type="checkbox" id="checkVis">
                <div class="switch"></div>
            </label>
            <div class="input-row" style="margin-top:15px;">
                <label style="font-size:0.7rem; min-width:60px;"><span id="ui-label-verts">頂点数</span>: <span id="vertNum">3</span></label>
                <input type="range" id="rangeVert" min="3" max="12" step="1">
            </div>
            <div class="input-row">
                <input type="color" id="pickColor">
                <input type="text" id="textHex" placeholder="#FFFFFF">
            </div>
        </div>

        <div class="control-block">
            <h3 id="ui-h-glow">光彩エフェクト</h3>
            <label class="switch-row">
                <span id="ui-label-glow-en">光彩を有効にする</span>
                <input type="checkbox" id="checkGlow">
                <div class="switch"></div>
            </label>
            <div class="input-row">
                <input type="color" id="pickGlow">
                <span style="font-size:0.7rem; opacity:0.6" id="ui-label-gcol">光彩の色</span>
            </div>
        </div>

        <div class="control-block">
            <h3 id="ui-h-points">ポリゴン座標 (選択中)</h3>
            <textarea id="areaPoints" readonly></textarea>
            <button onclick="copy('areaPoints')" style="width:100%; margin-top:8px; background:var(--accent-color)" id="ui-btn-pts">座標のみコピー</button>
        </div>

        <div class="control-block" style="border-color: #e67e2244;">
            <h3 style="color:#e67e22" id="ui-h-export">HTML一括書き出し</h3>
            <textarea id="areaHTML" readonly style="color:#ffcc66; height: 100px;"></textarea>
            <button onclick="copy('areaHTML')" style="width:100%; margin-top:8px; background:#e67e22" id="ui-btn-html">HTMLをコピー</button>
        </div>
    </div>
</div>

<script>
    const colors = ['#ff66cc', '#00ffff', '#33ff33'];
    let currentIdx = 0;
    let lang = 'ja';
    
    const i18n = {
        ja: {
            base: "基本設定", vis: "図形を表示する", verts: "頂点数", glow: "光彩エフェクト",
            glowEn: "光彩を有効にする", gcol: "光彩の色", pts: "ポリゴン座標 (選択中)",
            btnPts: "座標のみコピー", export: "HTML一括書き出し", btnHtml: "HTMLをコピー"
        },
        en: {
            base: "Base Settings", vis: "Show this shape", verts: "Vertices", glow: "Glow Effect",
            glowEn: "Enable Glow", gcol: "Glow Color", pts: "Polygon Points (Current)",
            btnPts: "Copy Points Only", export: "Full HTML Export", btnHtml: "Copy Full HTML"
        }
    };

    let shapes = [
        { vis: true, count: 3, col: '#ff66cc', glw: true, gcol: '#ff66cc', pts: [{x:50,y:20},{x:20,y:80},{x:80,y:80}] },
        { vis: false, count: 4, col: '#00ffff', glw: true, gcol: '#00ffff', pts: [{x:30,y:30},{x:70,y:30},{x:70,y:70},{x:30,y:70}] },
        { vis: false, count: 5, col: '#33ff33', glw: true, gcol: '#33ff33', pts: [{x:50,y:10},{x:90,y:40},{x:75,y:90},{x:25,y:90},{x:10,y:40}] }
    ];

    const svg = document.getElementById('canvas');
    const handleGroup = document.getElementById('handleGroup');

    function init() {
        render();
        updateUI();
        updateLang();
        
        document.getElementById('langToggle').onclick = () => { lang = lang === 'ja' ? 'en' : 'ja'; updateLang(); };

        document.getElementById('rangeVert').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            document.getElementById('vertNum').innerText = val;
            adjustPoints(currentIdx, val);
            render();
        });

        document.getElementById('checkVis').onchange = (e) => { shapes[currentIdx].vis = e.target.checked; render(); };
        document.getElementById('pickColor').oninput = (e) => { 
            shapes[currentIdx].col = e.target.value; 
            document.getElementById('textHex').value = e.target.value; 
            render(); 
        };
        document.getElementById('textHex').onchange = (e) => { shapes[currentIdx].col = e.target.value; render(); };
        document.getElementById('checkGlow').onchange = (e) => { shapes[currentIdx].glw = e.target.checked; render(); };
        document.getElementById('pickGlow').oninput = (e) => { shapes[currentIdx].gcol = e.target.value; render(); };

        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', (e) => onMove(e.touches[0]), {passive:false});
        window.addEventListener('mouseup', () => { dragData = null; });
        window.addEventListener('touchend', () => { dragData = null; });
    }

    let dragData = null;

    function getLuminance(hex) {
        const rgb = hex.replace('#','').match(/.{2}/g).map(x => parseInt(x, 16));
        return (rgb[0]*0.299 + rgb[1]*0.587 + rgb[2]*0.114);
    }

    function render() {
        handleGroup.innerHTML = '';
        let minLuminance = 255;

        shapes.forEach((s, sIdx) => {
            const poly = document.getElementById(`poly${sIdx}`);
            if (!s.vis) { poly.setAttribute('points',''); return; }
            if (getLuminance(s.col) < minLuminance) minLuminance = getLuminance(s.col);

            const pStr = s.pts.map(p => `${p.x},${p.y}`).join(' ');
            poly.setAttribute('points', pStr);
            poly.setAttribute('fill', s.col);
            poly.style.filter = s.glw ? `drop-shadow(0 0 10px ${s.gcol})` : 'none';

            poly.onmousedown = (e) => { dragData = { type:'shape', sIdx, ox:e.clientX, oy:e.clientY }; e.stopPropagation(); if(sIdx !== currentIdx) selectShape(sIdx); };
            poly.ontouchstart = (e) => { dragData = { type:'shape', sIdx, ox:e.touches[0].clientX, oy:e.touches[0].clientY }; e.stopPropagation(); if(sIdx !== currentIdx) selectShape(sIdx); };

            s.pts.forEach((p, pIdx) => {
                const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
                c.setAttribute('cx', p.x); c.setAttribute('cy', p.y); c.setAttribute('r', currentIdx === sIdx ? 4 : 2.5);
                c.setAttribute('class','handle'); c.setAttribute('fill', colors[sIdx]);
                
                const startPointDrag = (e) => { 
                    dragData = { type:'point', sIdx, pIdx }; 
                    e.stopPropagation(); 
                    if(sIdx !== currentIdx) selectShape(sIdx);
                };
                c.onmousedown = startPointDrag;
                c.ontouchstart = startPointDrag;
                handleGroup.appendChild(c);
            });
        });

        const canvasBox = document.getElementById('canvasBox');
        canvasBox.style.backgroundColor = minLuminance < 40 ? '#1a2235' : '#0b1020';
        updateExports();
    }

    function onMove(e) {
        if (!dragData) return;
        const rect = svg.getBoundingClientRect();
        if (dragData.type === 'point') {
            const x = Math.max(0, Math.min(100, Math.round(((e.clientX - rect.left) / rect.width) * 100)));
            const y = Math.max(0, Math.min(100, Math.round(((e.clientY - rect.top) / rect.height) * 100)));
            shapes[dragData.sIdx].pts[dragData.pIdx] = {x, y};
        } else if (dragData.type === 'shape') {
            const dx = ((e.clientX - dragData.ox) / rect.width) * 100;
            const dy = ((e.clientY - dragData.oy) / rect.height) * 100;
            shapes[dragData.sIdx].pts.forEach(p => {
                p.x = Math.max(0, Math.min(100, Math.round(p.x + dx)));
                p.y = Math.max(0, Math.min(100, Math.round(p.y + dy)));
            });
            dragData.ox = e.clientX; dragData.oy = e.clientY;
        }
        render();
    }

    function selectShape(idx) {
        currentIdx = idx;
        document.querySelectorAll('.shape-tab').forEach((t, i) => t.classList.toggle('active', i===idx));
        document.documentElement.style.setProperty('--accent-color', colors[idx]);
        updateUI();
        render();
    }

    function updateUI() {
        const s = shapes[currentIdx];
        document.getElementById('checkVis').checked = s.vis;
        document.getElementById('rangeVert').value = s.count;
        document.getElementById('vertNum').innerText = s.count;
        document.getElementById('pickColor').value = s.col;
        document.getElementById('textHex').value = s.col;
        document.getElementById('checkGlow').checked = s.glw;
        document.getElementById('pickGlow').value = s.gcol;
    }

    function updateLang() {
        const t = i18n[lang];
        document.getElementById('ui-h-base').innerText = t.base;
        document.getElementById('ui-label-vis').innerText = t.vis;
        document.getElementById('ui-label-verts').innerText = t.verts;
        document.getElementById('ui-h-glow').innerText = t.glow;
        document.getElementById('ui-label-glow-en').innerText = t.glowEn;
        document.getElementById('ui-label-gcol').innerText = t.gcol;
        document.getElementById('ui-h-points').innerText = t.pts;
        document.getElementById('ui-btn-pts').innerText = t.btnPts;
        document.getElementById('ui-h-export').innerText = t.export;
        document.getElementById('ui-btn-html').innerText = t.btnHtml;
        document.getElementById('tab0').innerText = lang === 'ja' ? '図形 1' : 'SHAPE 1';
        document.getElementById('tab1').innerText = lang === 'ja' ? '図形 2' : 'SHAPE 2';
        document.getElementById('tab2').innerText = lang === 'ja' ? '図形 3' : 'SHAPE 3';
    }

    function adjustPoints(idx, count) {
        const s = shapes[idx];
        if (count > s.pts.length) {
            while(s.pts.length < count) {
                const p1 = s.pts[s.pts.length-1], p2 = s.pts[0];
                s.pts.push({ x: Math.round((p1.x+p2.x)/2), y: Math.round((p1.y+p2.y)/2) });
            }
        } else {
            s.pts = s.pts.slice(0, count);
        }
        s.count = count;
    }

    function updateExports() {
        const curPts = shapes[currentIdx].pts.map(p => `${p.x},${p.y}`).join(' ');
        document.getElementById('areaPoints').value = curPts;
        let html = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width:300px; overflow:visible;">\n`;
        shapes.forEach(s => {
            if(!s.vis) return;
            const ps = s.pts.map(p => `${p.x},${p.y}`).join(' ');
            const g = s.glw ? `filter:drop-shadow(0 0 10px ${s.gcol});` : '';
            html += `  <polygon points="${ps}" style="fill:${s.col};${g}"></polygon>\n`;
        });
        html += `</svg>`;
        document.getElementById('areaHTML').value = html;
    }

    window.copy = function(id) {
        const el = document.getElementById(id);
        el.select();
        navigator.clipboard.writeText(el.value);
        const btn = event.target;
        const old = btn.innerText; 
        btn.innerText = lang === 'ja' ? 'コピー完了！' : 'COPIED!';
        setTimeout(() => btn.innerText = old, 1000);
    };

    init();
</script>
</body>
</html>
